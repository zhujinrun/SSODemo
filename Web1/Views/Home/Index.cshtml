@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">欢迎来到 Web1</h1>
    <p>Learn about <a href="http://localhost:7002">跳转到 Web2 </a>.</p>
    <p>Learn about <a onclick="logOut()" href="javascript:void(0);">退出登录</a>.</p>
</div>

@section Scripts{
    <script type="text/javascript">
        getUserInfo()
        //获取用户信息
        function getUserInfo() {
            //1.cookie是否有 token
            const token = getCookie('token')
            console.log('gettoken', token)
            if (!token) {
                //重定向到登录
                window.location.href = "http://localhost:7000/Account/Login?clientId=web1&redirectUrl=http://localhost:7001/Account/LoginRedirect";
            }
            $.ajax({
                type: 'POST',
                url: '/Account/GetUserInfo',
                headers: { "Authorization": 'Bearer ' + token },
                success: function() {
                    console.log('成功')
                },
                error: function(xhr, exception) {
                    if (xhr.status === 401) //鉴权失败
                    {
                        console.log('未鉴权')
                        //重定向到登录
                        window.location.href = "http://localhost:7000/Account/Login?clientId=web1&redirectUrl=http://localhost:7001/Account/LoginRedirect";
                    }
                }
            });
        }

        //退出登录
        function logOut() {
            clearCookie("token") //清除cookie token
            clearCookie("refreshToken") //清除cookie refreshToken
            clearCookie("sessionCode")  //清除cookie 会话

            //跳转到SSO退出登录
            window.location.href = "http://localhost:7000/Account/Logout?clientId=web1&redirectUrl=http://localhost:7001/Account/LoginRedirect"
        }
    </script>
}