@{
    ViewData["Title"] = "Login Page";
}

@section Scripts {
    <script type="text/javascript">
        GetAccessToken();
        //根据code获取token
        function GetAccessToken() {
            var params = GetParam()
            //code
            var authCode = params["authCode"]
            var sessionCode = params["sessionCode"]
            console.log('authcode', authCode)
            var params = { authCode, sessionCode }
            $.ajax({
                url: '/Account/GetAccessCode',
                type: "POST",
                data: JSON.stringify(params),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(data) {
                    console.log('token', data)
                    if (data.code === 0) //成功
                    {
                        console.log('设置cookie')
                        //把token存到 cookie,过期时间为token有效时间少一分钟
                        setCookie("token", data.data.token, data.data.expires - 60, "/")
                        //刷新token,有效期1天
                        setCookie("refreshToken", data.data.refreshToken, 24 * 60 * 60, "/")
                        setCookie("SessionCode", sessionCode, 24 * 60 * 60, "/")
                        //跳转到主页
                        window.location.href = "/Home/Index"
                    }
                }
            })

        }
    </script>
}